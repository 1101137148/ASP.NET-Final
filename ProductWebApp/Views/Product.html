<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>Product</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" href="http://cdn.kendostatic.com/2015.2.624/styles/kendo.common-material.min.css" />
    <link rel="stylesheet" href="http://cdn.kendostatic.com/2015.2.624/styles/kendo.blueopal.min.css" />

    <link rel="stylesheet" href="http://cdn.kendostatic.com/2015.2.624/styles/kendo.dataviz.min.css" />
    <link rel="stylesheet" href="http://cdn.kendostatic.com/2015.2.624/styles/kendo.dataviz.material.min.css" />

    <script src="http://cdn.kendostatic.com/2015.2.624/js/jquery.min.js"></script>
    <script src="http://cdn.kendostatic.com/2015.2.624/js/kendo.all.min.js"></script>
    <script src="http://cdn.kendostatic.com/2015.2.624/js/angular.min.js"></script>
    <script src="http://cdn.kendostatic.com/2015.2.624/js/jszip.min.js"></script>
    <script src="http://cdn.kendostatic.com/2015.2.624/js/messages/kendo.messages.zh-TW.min.js"></script>
    
    

    <script type="text/x-kendo-template" id="windowTemplate">
        <button class="k-button" id="yesButton">是</button>
        <button class="k-button" id="noButton"> 否</button>
    </script>
</head>
<body>
    <div class="content-pane">
        <div id="grid"></div>
    </div>
    <div id="window"></div>
    <script>
        
        $(document).ready(function () {
            var windowTemplate = kendo.template($("#windowTemplate").html());
            var UrlBase = "/";
            var window = $("#window").kendoWindow({
                title: "你確定是否要刪除該產品資訊?",
                visible: false, //the window will not appear before its .open method is called
                width: "400px",
                height: "200px",
            }).data("kendoWindow");

            $("#grid").kendoGrid({
                dataSource: {
                    pageSize: 5,
                    dataType: "jsonp",
                    transport: {
                        read: {
                            url: UrlBase + "api/Product",
                            contentType: "application/json; charset=utf-8",
                            type: "GET"
                        },
                        create: {
                            url: UrlBase + "api/Product",
                            contentType: "application/json; charset=utf-8",
                            type: "POST"
                        },
                        update: {
                            url: UrlBase + "api/Product",
                            contentType: "application/json; charset=utf-8",
                            type: "PUT"
                        },
                        destroy: {
                            url: UrlBase + "api/Product",
                            contentType: "application/json; charset=utf-8",
                            type: "DELETE"
                        },
                        parameterMap: function (data, operation) {
                            if (operation !== "read") {
                                return kendo.stringify(data);
                            }
                        }
                    },
                    schema: {
                        model: {
                            id: "ID",
                            fields: {
                                ID: { type: "int", editable: true, nullable: false},
                                Name: { type: "string", editable: true, nullable: false },
                                Price: { type: "int", editable: true, nullable: false },
                                Description: { type: "string", editable:true, nullable:false }
                            }
                        }
                    }

                },
                height: 550,
                sortable: true,
                scrollable: true,
                sortable: true,
                filterable: true,
                editable: "inline",
                toolbar: [{ name: "create",text:"新增" }],
                pageable: {
                    input: true,
                    numeric: false
                },
                columns: [
                    { field: "ID", title: "產品編號", width: "100px" },
                    { field: "Name", title: "產品名稱", width: "100px" },
                    { field: "Price", title: "產品價格", width: "100px" },
                    { field: "Description", title: "產品描述", width: "160px" },
                    {
                        command: [{ name: "edit", text: "修改" }, {
                            name: "Delete", text: "刪除", click: function (e) {  //add a click event listener on the delete button
                                var dataItem = this.dataItem($(e.target).closest("tr"));
                                var dataSource = $("#grid").data("kendoGrid").dataSource;
                                window.content(windowTemplate(dataItem)); //send the row data object to the template and render it
                                window.open().center();

                                $("#yesButton").click(function () {
                                    
                                    grid.dataSource.remove(dataItem) //prepare a "destroy" request
                                    grid.dataSource.sync()  //actually send the request (might be ommited if the autoSync option is enabled in the dataSource)
                                    window.close();
                                })
                                $("#noButton").click(function () {
                                    window.close();
                                })
                            }
                        
                        }], title: "操作", width: "250px"
                    }
                ]
            }).data("kendoGrid");

        });


    </script>
</body>
</html>
